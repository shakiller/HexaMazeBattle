<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HexMazeBattle</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>

<h1>üî∑ –ì–ï–ö–°–û–õ–ê–ë–ò–†–ò–ù–¢ –ë–∞—Ç—Ç–ª üî∑</h1>

<div class="game-container">
    <div class="game-mode-panel">
        <button class="mode-btn active" data-mode="simple" onclick="setGameMode('simple')">–î–æ —Ñ–∏–Ω–∏—à–∞</button>
        <button class="mode-btn" data-mode="flag" onclick="setGameMode('flag')">–° —Ñ–ª–∞–≥–æ–º ‚Ü©</button>
        <button class="mode-btn active" data-mode-type="single" onclick="setGameModeType('single')">1 –∏–≥—Ä–æ–∫</button>
        <button class="mode-btn" data-mode-type="bot" onclick="setGameModeType('bot')">ü§ñ –ë–æ—Ç</button>
        <button class="mode-btn" data-mode-type="online" onclick="setGameModeType('online')">üåê –û–Ω–ª–∞–π–Ω</button>
        <button class="mode-btn" onclick="restartGame()">üîÑ –ó–∞–Ω–æ–≤–æ</button>
        <button class="mode-btn" onclick="toggleSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ò–ò (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="ai-mode-panel" id="ai-mode-panel" style="display: none; margin: 10px 0; text-align: center;">
        <span style="margin-right: 10px; color: #fbbf24; font-weight: bold;">–°–ª–æ–∂–Ω–æ—Å—Ç—å –ò–ò:</span>
        <button class="mode-btn" id="btn-ai-easy" data-difficulty="easy">ü§ñ –õ–µ–≥–∫–∏–π</button>
        <button class="mode-btn" id="btn-ai-medium" data-difficulty="medium">ü§ñ –°—Ä–µ–¥–Ω–∏–π</button>
        <button class="mode-btn" id="btn-ai-hard" data-difficulty="hard">ü§ñ –°–ª–æ–∂–Ω—ã–π</button>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –æ–Ω–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="online-mode-panel" id="online-mode-panel" style="display: none; margin: 10px 0;">
        <div class="online-status-container">
            <div class="online-status-item">
                <span class="online-status-label">–°–µ—Ä–≤–µ—Ä:</span>
                <div class="status-indicator" id="server-status">
                    <span class="status-dot" id="server-status-dot"></span>
                    <span class="status-text" id="server-status-text">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                </div>
            </div>
            <div class="online-status-item">
                <span class="online-status-label">ID –∫–æ–º–Ω–∞—Ç—ã:</span>
                <div class="room-id-container">
                    <span class="room-id" id="room-id">‚Äî</span>
                    <button class="copy-btn" id="copy-room-id-btn" onclick="copyRoomId()" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID –∫–æ–º–Ω–∞—Ç—ã">üìã</button>
                </div>
            </div>
            <div class="online-status-item">
                <span class="online-status-label">–ò–≥—Ä–æ–∫ 1:</span>
                <div class="status-indicator">
                    <span class="status-dot" id="player1-status-dot"></span>
                    <span class="status-text" id="player1-status-text">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
                </div>
            </div>
            <div class="online-status-item">
                <span class="online-status-label">–ò–≥—Ä–æ–∫ 2:</span>
                <div class="status-indicator">
                    <span class="status-dot" id="player2-status-dot"></span>
                    <span class="status-text" id="player2-status-text">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
                </div>
            </div>
        </div>
        <div class="online-actions" id="online-actions" style="display: flex; gap: 10px; justify-content: center; margin-top: 15px; flex-wrap: wrap;">
            <button class="mode-btn" id="btn-create-room" onclick="createRoom()">üè† –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
            <button class="mode-btn" id="btn-join-room" onclick="showJoinDialog()">üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
            <button class="mode-btn" id="btn-disconnect" onclick="disconnectRoom()" style="display: none;">‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
        </div>
        <div class="join-dialog" id="join-dialog" style="display: none; margin-top: 15px; padding: 15px; background: rgba(30, 41, 59, 0.6); border-radius: 8px; border: 1px solid rgba(14, 165, 233, 0.3);">
            <input type="text" id="join-room-input" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∫–æ–º–Ω–∞—Ç—ã" onkeypress="if(event.key==='Enter') joinRoom()" style="padding: 8px 12px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(14, 165, 233, 0.4); border-radius: 6px; color: var(--text); font-family: inherit; font-size: 12px; width: 200px; margin-right: 10px;">
            <button class="mode-btn" onclick="joinRoom()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
            <button class="mode-btn" onclick="hideJoinDialog()" style="background: rgba(239, 68, 68, 0.2); border-color: #ef4444;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div class="settings-panel" id="settings-panel">
        <div class="setting-row">
            <label>–®–∏—Ä–∏–Ω–∞ –ø–æ–ª—è (—Å—Ç–æ–ª–±—Ü–æ–≤):</label>
            <input type="range" id="cols-slider" min="3" max="15" value="9" oninput="updateSettingDisplay()">
            <span id="cols-value">9</span>
        </div>
        <div class="setting-row">
            <label>–í—ã—Å–æ—Ç–∞ –ø–æ–ª—è (—Å—Ç—Ä–æ–∫):</label>
            <input type="range" id="rows-slider" min="3" max="15" value="9" oninput="updateSettingDisplay()">
            <span id="rows-value">9</span>
        </div>
        <div class="setting-row">
            <label>–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø:</label>
            <input type="range" id="gap-h-slider" min="-20" max="30" value="-3" oninput="updateSettingDisplay()">
            <span id="gap-h-value">-3</span>px
        </div>
        <div class="setting-row">
            <label>–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø:</label>
            <input type="range" id="gap-v-slider" min="-20" max="30" value="-19" oninput="updateSettingDisplay()">
            <span id="gap-v-value">-19</span>px
        </div>
        <div class="setting-row">
            <label>–†–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏:</label>
            <input type="range" id="size-slider" min="30" max="100" value="55" oninput="updateSettingDisplay()">
            <span id="size-value">55</span>px
        </div>
        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;">
            <button class="mode-btn" onclick="applySettings()">‚úì –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <button class="mode-btn" onclick="resetSettings()">‚Ü∫ –°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
    </div>

    <div class="top-panel">
        <div class="player-section player1 active" id="player1-section">
            <div class="player-token-preview p1"></div>
            <span class="player-title">–ò–≥—Ä–æ–∫</span>
        </div>

        <div class="dice-section">
            <div class="dice" id="dice" onclick="rollDice()">?</div>
            <button class="roll-btn" id="roll-btn" onclick="rollDice()">üé≤ –ë—Ä–æ—Å–∏—Ç—å</button>
        </div>

        <div class="points-display">
            <div class="points-value" id="points-value">0</div>
            <div class="points-label">–û–ß–ö–ò</div>
        </div>

        <div class="player-section player2" id="player2-section" style="display: none;">
            <div class="player-token-preview p2"></div>
            <span class="player-title">–ò–≥—Ä–æ–∫ 2</span>
        </div>

        <div class="tile-preview-section">
            <span class="tile-preview-label">–ù–æ–≤—ã–π —Ç–∞–π–ª</span>
            <div class="tile-preview-container">
                <button class="rotate-btn" onclick="rotateNextTile(-1)">‚Ü∂</button>
                <div class="tile-preview" id="next-tile"></div>
                <button class="rotate-btn" onclick="rotateNextTile(1)">‚Ü∑</button>
            </div>
        </div>
    </div>

    <div class="action-panel" id="action-panel">
        <button class="action-btn" id="btn-move" onclick="selectAction('move')" disabled>
            ‚û°Ô∏è –î–≤–∏–≥–∞—Ç—å—Å—è
            <span class="action-cost">1 –æ—á–∫–æ/—à–∞–≥</span>
        </button>
        <button class="action-btn" id="btn-place-adj" onclick="selectAction('placeAdjacent')" disabled>
            üß© –¢–∞–π–ª —Ä—è–¥–æ–º
            <span class="action-cost">2 –æ—á–∫–∞</span>
        </button>
        <button class="action-btn" id="btn-place-any" onclick="selectAction('placeAnywhere')" disabled>
            üó∫Ô∏è –¢–∞–π–ª –∫—É–¥–∞ —É–≥–æ–¥–Ω–æ
            <span class="action-cost">4 –æ—á–∫–∞</span>
        </button>
        <button class="action-btn" id="btn-replace-adj" onclick="selectAction('replaceAdjacent')" disabled>
            üîÑ –ò–∑–º–µ–Ω–∏—Ç—å —Ä—è–¥–æ–º
            <span class="action-cost">5 –æ—á–∫–æ–≤</span>
        </button>
        <button class="action-btn" id="btn-replace" onclick="selectAction('replace')" disabled>
            üîÑ –ò–∑–º–µ–Ω–∏—Ç—å –ª—é–±–æ–π
            <span class="action-cost">6 –æ—á–∫–æ–≤</span>
        </button>
        <button class="action-btn" id="btn-end" onclick="endTurn()" disabled>
            ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ö–æ–¥
        </button>
        <button id="btn-undo" class="action-btn">–û—Ç–º–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–∞–π–ª–∞</button>
    </div>

    <div class="status-bar" id="status">–ù–∞–∂–º–∏—Ç–µ "–ë—Ä–æ—Å–∏—Ç—å" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ö–æ–¥</div>

    <div class="board-wrapper">
        <div class="board" id="board"></div>
    </div>

    <div class="legend">
        <div class="legend-item"><div class="legend-color" style="background: #3b82f6"></div> –°—Ç–∞—Ä—Ç –∏–≥—Ä–æ–∫–∞ 1</div>
        <div class="legend-item"><div class="legend-color" style="background: #60a5fa"></div> –§–∏–Ω–∏—à –∏–≥—Ä–æ–∫–∞ 1</div>
        <div class="legend-item"><div class="legend-color" style="background: #ef4444"></div> –°—Ç–∞—Ä—Ç –∏–≥—Ä–æ–∫–∞ 2</div>
        <div class="legend-item"><div class="legend-color" style="background: #f87171"></div> –§–∏–Ω–∏—à –∏–≥—Ä–æ–∫–∞ 2</div>
        <div class="legend-item"><div class="legend-color" style="background: #fbbf24"></div> –ü—É—Ç—å</div>
        <div class="legend-item"><div class="legend-color" style="background: #666; border: 1px solid #999"></div> –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>
    </div>

    <div class="rules-panel">
        <h3>üìú –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π (—Ç—Ä–∞—Ç—å—Ç–µ –æ—á–∫–∏ –∫–∞–∫ —Ö–æ—Ç–∏—Ç–µ)</h3>
        <div class="rules-grid">
            <div class="rule-item"><span class="rule-cost">1</span> –î–≤–∏–∂–µ–Ω–∏–µ –Ω–∞ 1 –∫–ª–µ—Ç–∫—É</div>
            <div class="rule-item"><span class="rule-cost">2</span> –¢–∞–π–ª —Ä—è–¥–æ–º —Å —Ñ–∏—à–∫–æ–π</div>
            <div class="rule-item"><span class="rule-cost">4</span> –¢–∞–π–ª –Ω–∞ –ª—é–±–æ–µ –º–µ—Å—Ç–æ</div>
            <div class="rule-item"><span class="rule-cost">5</span> –ò–∑–º–µ–Ω–∏—Ç—å —Å–æ—Å–µ–¥–Ω–∏–π —Ç–∞–π–ª</div>
            <div class="rule-item"><span class="rule-cost">6</span> –ò–∑–º–µ–Ω–∏—Ç—å –ª—é–±–æ–π —Ç–∞–π–ª</div>
        </div>
        <div style="margin-top: 15px; padding: 10px; background: rgba(251, 191, 36, 0.1); border-radius: 5px;">
            <h4 style="margin: 0 0 5px 0; color: #fbbf24;">ü§ñ –†–µ–∂–∏–º –ò–ò</h4>
            <p style="margin: 0; font-size: 12px; color: #94a3b8;">
                <strong>–õ–µ–≥–∫–∏–π</strong>: —Å–ª—É—á–∞–π–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è<br>
                <strong>–°—Ä–µ–¥–Ω–∏–π</strong>: –ø—ã—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç–∏—á—å —Ñ–∏–Ω–∏—à–∞<br>
                <strong>–°–ª–æ–∂–Ω—ã–π</strong>: —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
            </p>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modal">
    <div class="modal">
        <h2 id="modal-title">üéâ –ü–æ–±–µ–¥–∞!</h2>
        <p id="modal-text">–ò–≥—Ä–æ–∫ 1 –¥–æ—Å—Ç–∏–≥ —Ñ–∏–Ω–∏—à–∞!</p>
        <div class="modal-buttons">
            <button class="modal-btn" onclick="closeModal()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="replace-modal">
    <div class="modal">
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</h2>
        <p id="replace-modal-text">–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Å —ç—Ç–∏–º —Ç–∞–π–ª–æ–º?</p>
        <div class="modal-buttons">
            <button class="modal-btn" onclick="doRotateTile()">‚Üª –ü–æ–≤–µ—Ä–Ω—É—Ç—å</button>
            <button class="modal-btn" onclick="doReplaceTile()">üîÅ –ó–∞–º–µ–Ω–∏—Ç—å</button>
            <button class="modal-btn secondary" onclick="cancelReplace()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>
<script src="script.js"></script>
<script>
// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ state –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π ai.js
if (typeof state === 'undefined') {
    console.error('–û—à–∏–±–∫–∞: state –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π ai.js');
}
</script>
<script src="ai.js"></script>
</body>
</html>